<h1> <%= @room.name %> </h1>

<p> Data de entrada: <%= @reservation.entry_date.strftime("%d/%m/%Y") %> </p>
<p> Check-in: <%= @room.guesthouse.check_in_time.strftime("%Hh%M") %> </p>

<p> Data de saída: <%= @reservation.departure_date.strftime("%d/%m/%Y") %> </p>
<p> Check-out: <%= @room.guesthouse.check_out_time.strftime("%Hh%M") %> </p>

<p>Quantidade de hóspedes: <%= @reservation.number_of_guests %></p>

<% if @reservation.finalized? %>
  <p>Total pago: R$ <%= number_with_precision(@reservation.total_price, precision: 2, separator: ',') %> </p>
  <p> Meio de pagamento utilizado: <%= @reservation.payment_method %> </p>
  <p>Estadia finalizada</p>
<% else %>
  <p> Valor total: R$ <%= number_with_precision(@reservation.total_price, precision: 2, separator: ',') %> </p> 
<% end %>

<% if @reservation.confirmed? && @reservation.cancellable? %>
  <%= form_for @reservation, url: room_cancel_reservation_path(@room, @reservation), method: :patch do |form| %>
    <%= form.submit 'Cancelar reserva' %>
  <% end %>
<% end %>

<% if owner_signed_in? && @reservation.confirmed? %>
  <%= button_to "Realizar check-in", reservation_check_in_path(@reservation), method: :post %>
<% end %>

<% if @reservation.active? %>

  <%= form_with(model: @reservation, url: reservation_check_out_path(@reservation), local: true, method: :post) do |form| %>

    <div class="field">
      <%= form.label :payment_method, "Meio de pagamento utilizado:" %>
      <%= form.text_field :payment_method %>
    </div>

    <div class="actions">
      <%= form.submit 'Realizar check-out' %>
    </div>

  <% end %>
<% end %>

<% if @reservation.finalized? && @reservation.review.nil? %>
  <%= form_for @review, url: reservation_reviews_path(@reservation), local: true, method: :post do |f| %>
    <%= f.label :rating %>
    <%= f.select :rating, (0..5).to_a %>

    <%= f.label :comment %>
    <%= f.text_area :comment %>

    <%= f.submit "Fazer avaliação" %>
  <% end %>
<% end %>